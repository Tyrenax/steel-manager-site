---
import '../styles/global.css';

interface Props {
  title: string;
  description?: string;
}

const { title, description = "Steel Manager - Logiciels industriels sur mesure" } = Astro.props;
---

<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>

    <!-- Preload fonts for better performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  </head>
  <body class="bg-steel-gradient min-h-screen antialiased">
    <!-- Page Loader -->
    <div id="page-loader" class="page-loader">
      <div class="loader-logo">
        <svg width="80" height="80" viewBox="0 0 44 44" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="22" cy="22" r="20" fill="url(#loaderGrad)" />
          <path d="M22 10 L22 34 M14 18 L22 10 L30 18" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
          <defs>
            <linearGradient id="loaderGrad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#00d6bf"/>
              <stop offset="100%" stop-color="#476bde"/>
            </linearGradient>
          </defs>
        </svg>
      </div>
    </div>

    <!-- Scroll Progress Bar -->
    <div id="scroll-progress" class="scroll-progress" style="transform: scaleX(0);"></div>

    <!-- Custom Cursor (desktop only) -->
    <div id="cursor-follower" class="cursor-follower hidden lg:block" style="opacity: 0;"></div>

    <!-- Main Content -->
    <div id="smooth-wrapper">
      <div id="smooth-content">
        <slot />
      </div>
    </div>

    <!-- Lenis Smooth Scroll -->
    <script is:inline src="https://unpkg.com/lenis@1.1.13/dist/lenis.min.js"></script>

    <script is:inline>
      // ═══════════════════════════════════════════════════════════════════════════
      // STEEL MANAGER - PREMIUM INTERACTIONS
      // ═══════════════════════════════════════════════════════════════════════════

      document.addEventListener('DOMContentLoaded', function() {

        // ─────────────────────────────────────────────────────────────────────────
        // PAGE LOADER
        // ─────────────────────────────────────────────────────────────────────────
        const loader = document.getElementById('page-loader');

        window.addEventListener('load', () => {
          setTimeout(() => {
            loader?.classList.add('hidden');
          }, 500);
        });

        // Fallback: hide loader after 3 seconds max
        setTimeout(() => {
          loader?.classList.add('hidden');
        }, 3000);

        // ─────────────────────────────────────────────────────────────────────────
        // LENIS SMOOTH SCROLL
        // ─────────────────────────────────────────────────────────────────────────
        let lenis;

        if (typeof Lenis !== 'undefined') {
          lenis = new Lenis({
            duration: 1.2,
            easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
            direction: 'vertical',
            gestureDirection: 'vertical',
            smooth: true,
            smoothTouch: false,
            touchMultiplier: 2,
          });

          function raf(time) {
            lenis.raf(time);
            requestAnimationFrame(raf);
          }

          requestAnimationFrame(raf);

          // Handle anchor links with smooth scroll
          document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
              const href = this.getAttribute('href');
              if (href && href !== '#') {
                e.preventDefault();
                const target = document.querySelector(href);
                if (target) {
                  lenis.scrollTo(target, { offset: -100 });
                }
              }
            });
          });
        }

        // ─────────────────────────────────────────────────────────────────────────
        // SCROLL PROGRESS BAR
        // ─────────────────────────────────────────────────────────────────────────
        const scrollProgress = document.getElementById('scroll-progress');

        function updateScrollProgress() {
          const scrollTop = window.scrollY;
          const docHeight = document.documentElement.scrollHeight - window.innerHeight;
          const progress = docHeight > 0 ? scrollTop / docHeight : 0;

          if (scrollProgress) {
            scrollProgress.style.transform = `scaleX(${progress})`;
          }
        }

        window.addEventListener('scroll', updateScrollProgress, { passive: true });

        // ─────────────────────────────────────────────────────────────────────────
        // CUSTOM CURSOR FOLLOWER
        // ─────────────────────────────────────────────────────────────────────────
        const cursor = document.getElementById('cursor-follower');

        if (cursor && window.innerWidth >= 1024) {
          let mouseX = 0, mouseY = 0;
          let cursorX = 0, cursorY = 0;

          document.body.classList.add('cursor-active');

          document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
            cursor.style.opacity = '1';
          });

          // Smooth cursor animation
          function animateCursor() {
            const dx = mouseX - cursorX;
            const dy = mouseY - cursorY;

            cursorX += dx * 0.15;
            cursorY += dy * 0.15;

            cursor.style.left = cursorX + 'px';
            cursor.style.top = cursorY + 'px';

            requestAnimationFrame(animateCursor);
          }

          animateCursor();

          // Hover effect on interactive elements
          const interactiveElements = document.querySelectorAll('a, button, [role="button"], .card-3d, .card-premium');

          interactiveElements.forEach(el => {
            el.addEventListener('mouseenter', () => cursor.classList.add('hover'));
            el.addEventListener('mouseleave', () => cursor.classList.remove('hover'));
          });

          // Hide cursor when leaving window
          document.addEventListener('mouseleave', () => {
            cursor.style.opacity = '0';
          });
        }

        // ─────────────────────────────────────────────────────────────────────────
        // INTERSECTION OBSERVER FOR REVEAL ANIMATIONS
        // ─────────────────────────────────────────────────────────────────────────
        const revealElements = document.querySelectorAll('.reveal, .reveal-left, .reveal-right, .reveal-scale');

        const revealObserver = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('visible');
              revealObserver.unobserve(entry.target);
            }
          });
        }, {
          threshold: 0.1,
          rootMargin: '0px 0px -50px 0px'
        });

        revealElements.forEach(el => revealObserver.observe(el));

        // ─────────────────────────────────────────────────────────────────────────
        // STAGGER ANIMATION OBSERVER
        // ─────────────────────────────────────────────────────────────────────────
        const staggerContainers = document.querySelectorAll('.stagger-children');

        const staggerObserver = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('animate');
              staggerObserver.unobserve(entry.target);
            }
          });
        }, {
          threshold: 0.2
        });

        staggerContainers.forEach(el => staggerObserver.observe(el));

        // ─────────────────────────────────────────────────────────────────────────
        // MAGNETIC BUTTON EFFECT
        // ─────────────────────────────────────────────────────────────────────────
        const magneticButtons = document.querySelectorAll('.magnetic-wrap');

        magneticButtons.forEach(btn => {
          const button = btn.querySelector('a, button');
          if (!button) return;

          btn.addEventListener('mousemove', (e) => {
            const rect = btn.getBoundingClientRect();
            const x = e.clientX - rect.left - rect.width / 2;
            const y = e.clientY - rect.top - rect.height / 2;

            button.style.transform = `translate(${x * 0.3}px, ${y * 0.3}px)`;
          });

          btn.addEventListener('mouseleave', () => {
            button.style.transform = 'translate(0, 0)';
          });
        });

        // ─────────────────────────────────────────────────────────────────────────
        // PARALLAX EFFECT ON SCROLL
        // ─────────────────────────────────────────────────────────────────────────
        const parallaxElements = document.querySelectorAll('.parallax-element');

        function updateParallax() {
          const scrollY = window.scrollY;

          parallaxElements.forEach(el => {
            const speed = el.dataset.speed || 0.5;
            const rect = el.getBoundingClientRect();
            const inView = rect.top < window.innerHeight && rect.bottom > 0;

            if (inView) {
              const yOffset = (scrollY - el.offsetTop) * speed;
              el.style.transform = `translateY(${yOffset}px)`;
            }
          });
        }

        window.addEventListener('scroll', updateParallax, { passive: true });

        // ─────────────────────────────────────────────────────────────────────────
        // 3D TILT EFFECT FOR CARDS
        // ─────────────────────────────────────────────────────────────────────────
        const tiltCards = document.querySelectorAll('.card-3d');

        tiltCards.forEach(card => {
          card.addEventListener('mousemove', (e) => {
            const rect = card.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const centerX = rect.width / 2;
            const centerY = rect.height / 2;

            const rotateX = (y - centerY) / 10;
            const rotateY = (centerX - x) / 10;

            card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateZ(10px)`;
          });

          card.addEventListener('mouseleave', () => {
            card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) translateZ(0)';
          });
        });

        // ─────────────────────────────────────────────────────────────────────────
        // TEXT REVEAL ON SCROLL
        // ─────────────────────────────────────────────────────────────────────────
        const textRevealElements = document.querySelectorAll('.text-reveal');

        const textRevealObserver = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('animate-text-reveal');
              textRevealObserver.unobserve(entry.target);
            }
          });
        }, {
          threshold: 0.5
        });

        textRevealElements.forEach(el => textRevealObserver.observe(el));

      });
    </script>
  </body>
</html>
