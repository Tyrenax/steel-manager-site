---
const barHeights = [40, 55, 35, 62, 48, 72, 58, 78, 85, 70, 82, 94];

const orders = [
  { id: '#4521', label: 'Découpe laser', status: 'En cours', color: 'accent' },
  { id: '#4520', label: 'Assemblage', status: 'Planifié', color: 'primary' },
  { id: '#4519', label: 'Contrôle qualité', status: 'Terminé', color: 'green' },
];
---

<section class="section-soft section-spacing section-anchor-line">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="grid lg:grid-cols-2 gap-12 lg:gap-16 items-center">

      <!-- Left: Text content -->
      <div data-aos="fade-right" data-aos-duration="400">
        <span class="badge badge-accent mb-6">Performance</span>
        <h2 class="text-3xl sm:text-4xl font-bold text-dark mb-6 leading-tight">
          Boostez votre efficacité <span class="text-gradient">opérationnelle</span>
        </h2>
        <p class="text-text-light text-lg leading-relaxed mb-8">
          Nos logiciels transforment vos données terrain en décisions immédiates.
          Production, stocks, ordres — tout est visible, en temps réel.
        </p>

        <div class="space-y-4">
          <div class="flex items-start gap-3">
            <div class="w-8 h-8 rounded-md bg-accent/10 flex items-center justify-center flex-shrink-0 mt-0.5">
              <svg class="w-4 h-4 text-accent" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
              </svg>
            </div>
            <div>
              <div class="text-dark font-medium text-sm">Suivi en temps réel</div>
              <div class="text-text-light text-sm">Chaque poste, chaque ordre, chaque minute — visible et traçable.</div>
            </div>
          </div>

          <div class="flex items-start gap-3">
            <div class="w-8 h-8 rounded-md bg-primary/10 flex items-center justify-center flex-shrink-0 mt-0.5">
              <svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 006 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0118 16.5h-2.25m-7.5 0h7.5m-7.5 0l-1 3m8.5-3l1 3m0 0l.5 1.5m-.5-1.5h-9.5m0 0l-.5 1.5" />
              </svg>
            </div>
            <div>
              <div class="text-dark font-medium text-sm">Décisions éclairées</div>
              <div class="text-text-light text-sm">Des tableaux de bord pensés pour l'action, pas la contemplation.</div>
            </div>
          </div>

          <div class="flex items-start gap-3">
            <div class="w-8 h-8 rounded-md bg-accent/10 flex items-center justify-center flex-shrink-0 mt-0.5">
              <svg class="w-4 h-4 text-accent" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.59 14.37a6 6 0 01-5.84 7.38v-4.8m5.84-2.58a14.98 14.98 0 006.16-12.12A14.98 14.98 0 009.631 8.41m5.96 5.96a14.926 14.926 0 01-5.841 2.58m-.119-8.54a6 6 0 00-7.381 5.84h4.8m2.581-5.84a14.927 14.927 0 00-2.58 5.84m2.699 2.7c-.103.021-.207.041-.311.06a15.09 15.09 0 01-2.448-2.448 14.9 14.9 0 01.06-.312m-2.24 2.39a4.493 4.493 0 00-1.757 4.306 4.493 4.493 0 004.306-1.758M16.5 9a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z" />
              </svg>
            </div>
            <div>
              <div class="text-dark font-medium text-sm">Gains mesurables</div>
              <div class="text-text-light text-sm">Nos clients constatent en moyenne +12% d'efficacité dès les premiers mois.</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right: Dashboard mockup (dark mode) -->
      <div data-aos="fade-left" data-aos-duration="400" data-aos-delay="100">
        <div class="relative">
          <div id="dashboard" class="relative rounded-xl overflow-hidden shadow-2xl shadow-dark/20" style="background: #1a1d29;">
            <!-- Browser chrome -->
            <div class="flex items-center gap-2 px-4 py-2.5" style="background: #252836; border-bottom: 1px solid rgba(255,255,255,0.06);">
              <div class="flex gap-1.5">
                <div class="w-2.5 h-2.5 rounded-full" style="background: #ff5f57;"></div>
                <div class="w-2.5 h-2.5 rounded-full" style="background: #febc2e;"></div>
                <div class="w-2.5 h-2.5 rounded-full" style="background: #28c840;"></div>
              </div>
              <div class="flex-1 mx-3">
                <div class="h-5 rounded-md flex items-center px-3" style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.06);">
                  <span class="text-[10px]" style="color: rgba(255,255,255,0.3);">app.devteix.be/dashboard</span>
                </div>
              </div>
            </div>

            <!-- Dashboard content -->
            <div class="p-5 space-y-3">
              <!-- Metrics row -->
              <div class="grid grid-cols-3 gap-2.5">
                <div class="rounded-lg p-3 dashboard-metric" style="background: rgba(67, 97, 238, 0.08); border: 1px solid rgba(67, 97, 238, 0.12);">
                  <div class="text-[10px] mb-1" style="color: rgba(255,255,255,0.4);">Production</div>
                  <div class="text-lg font-bold metric-value" style="color: #6b8aff;" data-target="94.2">0%</div>
                </div>
                <div class="rounded-lg p-3 dashboard-metric" style="background: rgba(6, 214, 160, 0.08); border: 1px solid rgba(6, 214, 160, 0.12);">
                  <div class="text-[10px] mb-1" style="color: rgba(255,255,255,0.4);">Efficacité</div>
                  <div class="text-lg font-bold metric-value" style="color: #06d6a0;" data-target="12">+0%</div>
                </div>
                <div class="rounded-lg p-3 dashboard-metric" style="background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.06);">
                  <div class="text-[10px] mb-1" style="color: rgba(255,255,255,0.4);">En cours</div>
                  <div class="text-lg font-bold metric-value" style="color: rgba(255,255,255,0.9);" data-target="847">0</div>
                </div>
              </div>

              <!-- Chart -->
              <div class="rounded-lg p-4" style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06);">
                <div class="flex items-center justify-between mb-3">
                  <span class="text-xs font-medium" style="color: rgba(255,255,255,0.7);">Suivi temps réel</span>
                  <span class="text-[10px]" style="color: rgba(255,255,255,0.3);">Dernière heure</span>
                </div>
                <div class="flex items-end gap-1.5" style="height: 72px;" id="dashboard-chart">
                  {barHeights.map((height, i) => (
                    <div class="flex-1 rounded-t overflow-hidden dashboard-bar" style={`height: ${height}%`} data-delay={i * 50}>
                      <div class="w-full h-full relative" style="background: rgba(67, 97, 238, 0.12);">
                        <div class="absolute bottom-0 w-full rounded-t bar-fill" style="height: 0%; background: linear-gradient(180deg, #6b8aff 0%, #4361ee 100%);" data-height={`${Math.min(height + 10, 100)}%`}></div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              <!-- Orders -->
              <div class="space-y-1.5" id="dashboard-orders">
                {orders.map((order, i) => (
                  <div
                    class="flex items-center justify-between py-2 px-3 rounded-lg dashboard-order"
                    style={`opacity: 0; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06);`}
                    data-delay={i * 150}
                  >
                    <span class="text-xs" style="color: rgba(255,255,255,0.6);">Ordre {order.id} — {order.label}</span>
                    <span
                      class="text-[10px] px-2 py-0.5 rounded-full font-medium"
                      style={order.color === 'accent'
                        ? 'background: rgba(6,214,160,0.12); color: #06d6a0;'
                        : order.color === 'primary'
                          ? 'background: rgba(67,97,238,0.12); color: #6b8aff;'
                          : 'background: rgba(34,197,94,0.12); color: #4ade80;'
                      }
                    >
                      {order.status}
                    </span>
                  </div>
                ))}
              </div>
            </div>
          </div>

          <!-- Glow effects behind the dashboard -->
          <div class="absolute -top-8 -right-8 w-40 h-40 rounded-full -z-10" style="background: radial-gradient(circle, rgba(67,97,238,0.15) 0%, transparent 70%);"></div>
          <div class="absolute -bottom-6 -left-6 w-32 h-32 rounded-full -z-10" style="background: radial-gradient(circle, rgba(6,214,160,0.1) 0%, transparent 70%);"></div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  function animateDashboard() {
    const dashboard = document.getElementById('dashboard');
    if (!dashboard) return;

    const metrics = dashboard.querySelectorAll('.metric-value');
    metrics.forEach((metric) => {
      const el = metric as HTMLElement;
      const target = parseFloat(el.dataset.target || '0');
      const isPercent = el.textContent?.includes('%');
      const isPlus = el.textContent?.includes('+');
      let current = 0;
      const duration = 1200;
      const steps = 30;
      const increment = target / steps;
      let step = 0;

      const timer = setInterval(() => {
        step++;
        current += increment;
        if (step >= steps) {
          current = target;
          clearInterval(timer);
        }
        if (target === 847) {
          el.textContent = Math.round(current).toString();
        } else if (isPlus) {
          el.textContent = `+${current.toFixed(current === target ? 0 : 0)}%`;
        } else {
          el.textContent = `${current.toFixed(current === target ? 1 : 0)}%`;
        }
      }, duration / steps);
    });

    const bars = dashboard.querySelectorAll('.bar-fill');
    bars.forEach((bar) => {
      const el = bar as HTMLElement;
      const targetHeight = el.dataset.height || '0%';
      const parentDelay = parseInt((el.closest('.dashboard-bar') as HTMLElement)?.dataset.delay || '0');
      setTimeout(() => {
        el.style.transition = 'height 0.6s cubic-bezier(0.16, 1, 0.3, 1)';
        el.style.height = targetHeight;
      }, parentDelay);
    });

    const orders = dashboard.querySelectorAll('.dashboard-order');
    orders.forEach((order) => {
      const el = order as HTMLElement;
      const delay = parseInt(el.dataset.delay || '0');
      setTimeout(() => {
        el.style.transition = 'opacity 0.4s ease, transform 0.4s ease';
        el.style.opacity = '1';
        el.style.transform = 'translateX(0)';
      }, 600 + delay);
    });
  }

  function resetDashboard() {
    const dashboard = document.getElementById('dashboard');
    if (!dashboard) return;

    const bars = dashboard.querySelectorAll('.bar-fill') as NodeListOf<HTMLElement>;
    bars.forEach((bar) => {
      bar.style.transition = 'none';
      bar.style.height = '0%';
    });

    const orders = dashboard.querySelectorAll('.dashboard-order') as NodeListOf<HTMLElement>;
    orders.forEach((order) => {
      order.style.transition = 'none';
      order.style.opacity = '0';
      order.style.transform = 'translateX(-20px)';
    });
  }

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        animateDashboard();
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.3 });

  const dashboardEl = document.getElementById('dashboard');
  if (dashboardEl) {
    dashboardEl.querySelectorAll('.dashboard-order').forEach((order) => {
      (order as HTMLElement).style.transform = 'translateX(-20px)';
    });

    observer.observe(dashboardEl);

    dashboardEl.addEventListener('mouseenter', () => {
      resetDashboard();
      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          animateDashboard();
        });
      });
    });
  }
</script>
